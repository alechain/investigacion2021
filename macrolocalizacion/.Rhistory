IPCFR=IPCF/DEFLACTOR,
IPCFRL=log(IPCFR),
OCUPADO_BAJO=case_when(ESTADO==1 & CALIFICACION %in% c("No Calificados", "Operativos") ~ 1,
TRUE ~ 0),
OCUPADO_ALTO=case_when(ESTADO==1 & CALIFICACION %in% c("Profesionales","Técnicos") ~ 1,
TRUE ~ 0),
PROPIETARIO=case_when(II7==1 | II7==2 ~ 1,
TRUE ~ 0),
HIJO_DUMMY=case_when(HIJO_HOGAR==0 ~ 0,
TRUE ~ 1),
CASADO= case_when(CH07==1 | CH07==2 ~ 1 ,
TRUE ~ 0),
CASADO_C_HIJO=CASADO*HIJO_DUMMY,
POBRE=case_when(condicion %in% c("Pobre","Indigente")~1,
TRUE ~ 0),
SUBSIDIO=case_when(V5==1 ~ 1,
TRUE ~ 0)
)
cluster1_expulsion<- left_join(ephtotal,cluster_destino)
cluster1_expulsion<- left_join(cluster1_expulsion,cluster_nombres_eph_ch15)
cluster1_expulsion<- cluster1_expulsion %>%  filter(cluster_destino==1 | cluster_origen==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH03==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH15%in% c(1,2,3))
cluster1_expulsion<- cluster1_expulsion %>% mutate(inmigrante=case_when(cluster_origen==1  &  CH15==3 &   cluster_destino!=1 ~1,
cluster_destino==1 & CH15 %in% c(1,2) ~0))
cluster1_expulsion<- cluster1_expulsion %>% filter(!is.na(inmigrante))
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + CASADO_C_HIJO+PROPIETARIO+ HIJO_DUMMY + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = "binomial")
summary(cluster_exp1)
cluster2_expulsion<- left_join(ephtotal,cluster_destino)
cluster2_expulsion<- left_join(cluster2_expulsion,cluster_nombres_eph_ch15)
cluster2_expulsion<- cluster2_expulsion %>%  filter(cluster_destino==2 | cluster_origen==2)
cluster2_expulsion<- cluster2_expulsion %>% filter(CH15%in% c(1,2,3))
cluster2_expulsion<- cluster2_expulsion %>% filter(CH03==1)
cluster2_expulsion<- cluster2_expulsion %>% mutate(inmigrante=case_when(cluster_origen==2  &  CH15==3 &   cluster_destino!=2~1,
cluster_destino==2 & CH15 %in% c(1,2) ~0))
cluster2_expulsion<- cluster2_expulsion %>% filter(!is.na(inmigrante))
cluster_exp2<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + CASADO_C_HIJO+ PROPIETARIO+ HIJO_DUMMY + edad  +edad2 + medio + alto, data= cluster2_expulsion,family = "binomial")
summary(cluster_exp2)
cluster3_expulsion<- left_join(ephtotal,cluster_destino)
cluster3_expulsion<- left_join(cluster3_expulsion,cluster_nombres_eph_ch15)
cluster3_expulsion<- cluster3_expulsion %>%  filter(cluster_destino==3 | cluster_origen==3)
cluster3_expulsion<- cluster3_expulsion %>% filter(CH15%in% c(1,2,3))
cluster3_expulsion<- cluster3_expulsion %>% filter(CH03==1)
cluster3_expulsion<- cluster3_expulsion %>% mutate(inmigrante=case_when(cluster_origen==3  &  CH15==3 &   cluster_destino!=3 ~1,
cluster_destino==3 & CH15 %in% c(1,2) ~0))
cluster3_expulsion<- cluster3_expulsion %>% filter(!is.na(inmigrante))
cluster_exp3<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO +  OCUPADO_BAJO+OCUPADO_ALTO + CASADO+ CASADO_C_HIJO + PROPIETARIO+ HIJO_DUMMY + edad  +edad2 + medio + alto ,data = cluster3_expulsion,family = "binomial")
summary(cluster_exp3)
#Grafico de regresiones en stargazer
stargazer(cluster_exp1,cluster_exp2, cluster_exp3)
cluster1_atraccion<- left_join(ephtotal,cluster_destino)
cluster1_atraccion<- left_join(cluster1_atraccion,cluster_nombres_eph_ch15)
cluster1_atraccion <- cluster1_atraccion %>% filter(CH15==3)
cluster1_atraccion<- cluster1_atraccion %>% mutate(inmigrante=case_when(cluster_destino==1 ~1,
(cluster_destino==2 | cluster_destino==3)~0))
cluster1_atraccion<- cluster1_atraccion %>% filter(!is.na(inmigrante))
cluster1_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr1<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO +  OCUPADO_BAJO+OCUPADO_ALTO + CASADO + PROPIETARIO+ HIJO_DUMMY + edad   + medio + alto ,data = cluster1_atraccion,family = "binomial")
summary(cluster_atr1)
cluster2_atraccion<- left_join(ephtotal,cluster_destino)
cluster2_atraccion<- left_join(cluster2_atraccion,cluster_nombres_eph_ch15)
cluster2_atraccion <- cluster2_atraccion %>% filter(CH15==3)
cluster2_atraccion<- cluster2_atraccion %>% mutate(inmigrante=case_when(cluster_destino==2 ~1,
(cluster_destino==1 | cluster_destino==3)~0))
cluster2_atraccion<- cluster2_atraccion %>% filter(!is.na(inmigrante))
cluster2_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr2<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO +  OCUPADO_BAJO+OCUPADO_ALTO + CASADO + PROPIETARIO+ HIJO_DUMMY + edad  + edad2 + medio + alto ,data = cluster2_atraccion,family = "binomial")
summary(cluster_atr2)
cluster3_atraccion<- left_join(ephtotal,cluster_destino)
cluster3_atraccion<- left_join(cluster3_atraccion,cluster_nombres_eph_ch15)
cluster3_atraccion <- cluster3_atraccion %>% filter(CH15==3)
cluster3_atraccion<- cluster3_atraccion %>% mutate(inmigrante=case_when(cluster_destino==3 ~1,
(cluster_destino==1 | cluster_destino==2)~0))
cluster3_atraccion<- cluster3_atraccion %>% filter(!is.na(inmigrante))
cluster3_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr3<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO +  OCUPADO_BAJO+OCUPADO_ALTO + CASADO + PROPIETARIO+ HIJO_DUMMY + edad   + medio + alto ,data = cluster3_atraccion,family = "binomial")
summary(cluster_atr3)
rm(list=c("cluster1_expulsion","cluster2_expulsion", "cluster3_expulsion"))
rm(list=ls("cluster1_expulsion","cluster2_expulsion", "cluster3_expulsion"))
cluster1_expulsion<- left_join(ephtotal,cluster_destino)
cluster1_expulsion<- left_join(cluster1_expulsion,cluster_nombres_eph_ch15)
cluster1_expulsion<- cluster1_expulsion %>%  filter(cluster_destino==1 | cluster_origen==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH03==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH15%in% c(1,2,3))
cluster1_expulsion<- cluster1_expulsion %>% mutate(inmigrante=case_when(cluster_origen==1  &  CH15==3 &   cluster_destino!=1 ~1,
cluster_destino==1 & CH15 %in% c(1,2) ~0))
cluster1_expulsion<- cluster1_expulsion %>% filter(!is.na(inmigrante))
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + CASADO_C_HIJO+PROPIETARIO+ HIJO_DUMMY + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = "binomial")
summary(cluster_exp1)
ls()
unique(cluster1_expulsion$P47T)
table(cluster1_expulsion$P47T)
table(cluster1_expulsion$IPCF)
cluster1_expulsion %>% filter(is.na(IPCF))
cluster1_expulsion %>% filter(is.na(POBRE))
cluster1_expulsion %>% filter(is.na(P21))
cluster1_expulsion %>% filter(P21==9)
cluster1_expulsion %>% filter(P21==-9)
ephtotal$SECTOR_ACT
cluster1_expulsion %>% group_by(SECTOR_ACT) %>% count()
View(resumen2)
holis
holis<- cluster1_expulsion %>% group_by(SECTOR_ACT) %>% count()
View(holis)
holis<- cluster1_expulsion %>% group_by(SECTOR_ACT,ESTADO) %>% count()
rm(holis)
#Grafico de regresiones en stargazer
stargazer(cluster_exp1,cluster_exp2, cluster_exp3)
#Grafico de regresiones en stargazer
stargazer(cluster_exp1,cluster_exp2, cluster_exp3,font.size = "small")
cluster1_expulsion<- left_join(ephtotal,cluster_destino)
cluster1_expulsion<- left_join(cluster1_expulsion,cluster_nombres_eph_ch15)
cluster1_expulsion<- cluster1_expulsion %>%  filter(cluster_destino==1 | cluster_origen==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH03==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH15%in% c(1,2,3))
cluster1_expulsion<- cluster1_expulsion %>% mutate(inmigrante=case_when(cluster_origen==1  &  CH15==3 &   cluster_destino!=1 ~1,
cluster_destino==1 & CH15 %in% c(1,2) ~0))
cluster1_expulsion<- cluster1_expulsion %>% filter(!is.na(inmigrante))
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + CASADO_C_HIJO+PROPIETARIO+ HIJO_DUMMY + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = "binomial")
summary(cluster_exp1)
summary(cluster_exp1)
install.packages("margins")
margins::margins(cluster_exp1)
margins::marginal_effects(cluster_exp1)
margins::margins(cluster_exp1)
margins::margins(cluster_exp1, type="link")
margins::margins(cluster_exp1, type="response")
exp(0.02929759)
exp(-0.001566873	)
margins::cplot(cluster_exp1)
margins::cplot(cluster_exp1,edad)
margins::cplot(cluster_exp1,"edad")
margins::cplot(cluster_exp1,"edad2")
margins::cplot(cluster_exp1,"subsidio")
margins::cplot(cluster_exp1,"SUBSIDIO")
margins::cplot(cluster_exp1,"SUBSIDIO") + theme_minimal()
margins::cplot(cluster_exp1,"SUBSIDIO")
margins::cplot(cluster_exp1,"SUBSIDIO")
margins::margins(cluster_exp1, type="response")
margins::margins(cluster_exp1, type="link")
clus<-margins::margins(cluster_exp1, type="link")
plot(clus)
clus<-margins::margins(cluster_exp1, type="response")
plot(clus)
clus<-margins::margins(cluster_exp1, type="link")
plot(clus)
cluster_exp1LIN<- lm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + CASADO_C_HIJO+PROPIETARIO+ HIJO_DUMMY + edad + edad2  + medio + alto ,data = cluster1_expulsion)
summary(cluster_exp1LIN)
margins::margins(cluster_exp2)
cluster2_expulsion<- left_join(ephtotal,cluster_destino)
cluster2_expulsion<- left_join(cluster2_expulsion,cluster_nombres_eph_ch15)
cluster2_expulsion<- cluster2_expulsion %>%  filter(cluster_destino==2 | cluster_origen==2)
cluster2_expulsion<- cluster2_expulsion %>% filter(CH15%in% c(1,2,3))
cluster2_expulsion<- cluster2_expulsion %>% filter(CH03==1)
cluster2_expulsion<- cluster2_expulsion %>% mutate(inmigrante=case_when(cluster_origen==2  &  CH15==3 &   cluster_destino!=2~1,
cluster_destino==2 & CH15 %in% c(1,2) ~0))
cluster2_expulsion<- cluster2_expulsion %>% filter(!is.na(inmigrante))
cluster_exp2<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + CASADO_C_HIJO+ PROPIETARIO+ HIJO_DUMMY + edad  +edad2 + medio + alto, data= cluster2_expulsion,family = "binomial")
summary(cluster_exp2)
margins::margins(cluster_exp2)
margins::margins(cluster_exp2)
cluster_exp1LIN<- lm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + PROPIETARIO+ HIJO_DUMMY + edad + edad2  + medio + alto ,data = cluster1_expulsion)
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO + CASADO + PROPIETARIO+ HIJO_DUMMY + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = "binomial")
margins::margins(cluster_exp1)
summary(cluster_atr1)
margins::margins(cluster_atr1)
cluster_atr1<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO +  OCUPADO_BAJO+OCUPADO_ALTO + CASADO + PROPIETARIO+ HIJO_DUMMY + edad   + medio + alto ,data = cluster1_atraccion,family = binomial(link="probit"))
summary(cluster_atr1)
margins::margins(cluster_atr1)
ephtotal<- ephtotal %>% mutate(hombre=case_when(Sexo=="Hombres"~1,
Sexo=="Mujeres"~0),
edad=case_when(CH06=="-1" ~ as.integer(1),
TRUE ~ as.integer(CH06)),
edad2=(edad)^2,
ledad=log(edad),
medio=case_when(niveled=="Secundario\nCompleto"~ 1,
TRUE ~ 0),
alto=case_when(niveled=="Superior/Universitario\ncompleto"~ 1,
TRUE ~ 0),
IPCFR=IPCF/DEFLACTOR,
IPCFRL=log(IPCFR),
OCUPADO_BAJO=case_when(ESTADO==1 & CALIFICACION %in% c("No Calificados", "Operativos") ~ 1,
TRUE ~ 0),
OCUPADO_ALTO=case_when(ESTADO==1 & CALIFICACION %in% c("Profesionales","Técnicos") ~ 1,
TRUE ~ 0),
PROPIETARIO=case_when(II7==1 | II7==2 ~ 1,
TRUE ~ 0),
HIJO_DUMMY=case_when(HIJO_HOGAR==0 ~ 0,
TRUE ~ 1),
CASADO= case_when(CH07==1 | CH07==2 ~ 1 ,
TRUE ~ 0),
SOLTERO_C_HIJO=case_when(CASADO==0 & HIJO_DUMMY==1~1,
TRUE~0),
CASADO_S_HIJO=case_when(CASADO==1 & HIJO_DUMMY==0~ 1,
TRUE ~ 0),
CASADO_C_HIJO=case_when(CASADO==1 & HIJO_DUMMY==1~1,
TRUE~0),
POBRE=case_when(condicion %in% c("Pobre","Indigente")~1,
TRUE ~ 0),
SUBSIDIO=case_when(V5==1 ~ 1,
TRUE ~ 0)
)
cluster1_expulsion<- left_join(ephtotal,cluster_destino)
cluster1_expulsion<- left_join(cluster1_expulsion,cluster_nombres_eph_ch15)
cluster1_expulsion<- cluster1_expulsion %>%  filter(cluster_destino==1 | cluster_origen==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH03==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH15%in% c(1,2,3))
cluster1_expulsion<- cluster1_expulsion %>% mutate(inmigrante=case_when(cluster_origen==1  &  CH15==3 &   cluster_destino!=1 ~1,
cluster_destino==1 & CH15 %in% c(1,2) ~0))
cluster1_expulsion<- cluster1_expulsion %>% filter(!is.na(inmigrante))
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = "binomial")
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = binomial(link="logit"))
summary(cluster_exp1)
rm(list=ls())
setwd("/home/alejandrochain/Documentos/GitHub/investigacion2021/macrolocalizacion")
knitr::opts_chunk$set(echo = FALSE, dev="cairo_pdf")
library(readr)
library(tidyverse)
library(factoextra)
library(cluster)
library(fpc)
#estos sirven para formatear pa latex
library(stargazer)
library(xtable)
library(extrafont)
library(eph)
library(readxl)
color<- c('#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf')
## Individual
ephi<- get_microdata(year=2017:2019, trimester = 1:4, type = "individual")
ephi<- ephi %>%
dplyr::select(microdata) %>%
tidyr::unnest(cols = c(microdata))
### 2016
ephi2<- get_microdata(year=2016, trimester = 2:4, type = "individual")
ephi2<- ephi2 %>%
dplyr::select(microdata) %>%
tidyr::unnest(cols = c(microdata))
ephi<- bind_rows(ephi,ephi2)
ephi<- ephi %>% arrange(-ANO4, -TRIMESTRE)
## Hogar
ephh<- get_microdata(year=2017:2019, trimester = 1:4, type = "hogar")
ephh<- ephh %>%
dplyr::select(microdata) %>%
tidyr::unnest(cols = c(microdata))
### 2016
ephh2<- get_microdata(year=2016, trimester = 2:4, type = "hogar")
ephh2<- ephh2 %>%
dplyr::select(microdata) %>%
tidyr::unnest(cols = c(microdata))
ephh<- bind_rows(ephh,ephh2)
ephh<- ephh %>% arrange(-ANO4, -TRIMESTRE)
### mergeado
ephtotal<- left_join(ephi,ephh)
### aglomerado
aglomerado<- read_excel("aglomerado.xlsx",sheet = 4)
### Sector
sectorcaes<- read.csv("SECTORESCAES.csv", sep=",", header = T, encoding = "UTF-8", colClasses = "character")
### provincia
provincia<- read.csv("provincias.csv", sep=",", header = T)
provincia1<- provincia %>% select(PROVINCIA,CH15_COD)
provincia2<- provincia %>% select(PROVINCIA,CH16_COD)
ephtotal<- ephtotal %>% filter(ESTADO!=0) %>%  mutate(Sexo=as.character(CH04),
Sexo=case_when(Sexo=="1" ~ "Hombres",
Sexo=="2" ~ "Mujeres"),
PP04D_COD = case_when(nchar(PP04D_COD) == 5 ~ PP04D_COD,
nchar(PP04D_COD) == 4 ~ paste0("0", PP04D_COD),
nchar(PP04D_COD) == 3 ~ paste0("00", PP04D_COD),
nchar(PP04D_COD) == 2 ~ paste0("000", PP04D_COD),
nchar(PP04D_COD) == 1 ~ paste0("0000", PP04D_COD)),
CALIFICACION = substr(PP04D_COD, 5, 5),
JERARQUIA = substr(PP04D_COD, 3, 3),
JERARQUIA = case_when(JERARQUIA=="0" ~ "Dirección",
JERARQUIA=="2" ~ "Jefes",
JERARQUIA=="1" ~ "Cuentapropia",
JERARQUIA=="3" ~ "Trabajadores\nAsalariados"),
JERARQUIA = factor(JERARQUIA, c("Dirección", "Jefes", "Trabajadores\nAsalariados", "Cuentapropia")),
PEA= case_when(ESTADO==3 ~ 0,
ESTADO==4 ~ 0,
ESTADO==1 ~ 1,
ESTADO==2 ~ 1),
PP04D_COD = as.character(PP04D_COD),
CALIFICACION = case_when(CALIFICACION=="1" ~ "Profesionales",
CALIFICACION=="2" ~ "Técnicos",
CALIFICACION=="3" ~ "Operativos",
CALIFICACION=="4" ~ "No Calificados"),
CALIFICACION = factor(CALIFICACION, c("No Calificados", "Operativos", "Técnicos", "Profesionales")),
PP04B_COD=as.character(PP04B_COD),
PP04B_COD=case_when(nchar(PP04B_COD)==4~PP04B_COD,
nchar(PP04B_COD)==1~ paste0("0",PP04B_COD,"00"),
nchar(PP04B_COD)==2~ paste0(PP04B_COD,"00"),
nchar(PP04B_COD)==3~ paste0("0",PP04B_COD)),
SECTOR= substr(PP04B_COD,1,2),
HORASSEM=PP3E_TOT+PP3F_TOT,
niveled=case_when(NIVEL_ED==1 | NIVEL_ED==7 ~ "Sin\ninstrucción",
NIVEL_ED %in% c(2,3) ~ "Primario\nCompleto",
NIVEL_ED %in% c(4,5)~ "Secundario\nCompleto",
NIVEL_ED == 6 ~ "Superior/Universitario\ncompleto"),
niveled=factor(niveled, levels = c("Sin\ninstrucción","Primario\nCompleto","Secundario\nCompleto","Superior/Universitario\ncompleto")))
ephtotal<- left_join(ephtotal,aglomerado)
ephtotal<- left_join(ephtotal, sectorcaes)
datos<- read_csv("macroloc_para_r.csv",col_names = T, row.names(1))
datos3<- datos %>% select(-Provincia)
row.names(datos3)<- datos$Provincia
datos4<- datos3
#datos<- datos %>% mutate(`Densidad poblacional: Hab/km² (2010)`=log(`Densidad poblacional: Hab/km² (2010)`))
datos3<-datos3 %>% select(-c(`Densidad poblacional: Hab/km² (2010)`))
datos_norm<- scale(datos3)
factoextra::fviz_nbclust(datos_norm,kmeans, method="wss")+ geom_vline(xintercept = 3, colour="RED", linetype="dotted") + theme_classic() + labs(title="Numero óptimo de clusters") + xlab("Número de clusters") + ylab("WSS")+ theme(text=element_text(family = "LM Roman 10"), title = element_text(face = "bold"))
set.seed(1118)
km_clusters<- kmeans(datos_norm,centers = 3,iter.max = 1000,nstart = 2000)
nomenclador<- km_clusters$cluster
resumen_cluster<-aggregate(datos3,by = list(cluster=km_clusters$cluster),FUN = median)
resumen_g<-resumen_cluster %>% pivot_longer(-cluster)
resumen2<-data.frame(t(resumen_cluster))
resumen2<- resumen2 %>% rename("Cluster 1"=X1,"Cluster 2"=X2, "Cluster 3"=X3) %>% rownames_to_column()
resumen2<- resumen2 %>% rename("Indicadores"=rowname)
resumen2<- resumen2 %>% filter(Indicadores!="cluster")
resumen2$`Cluster 1`<- formattable::comma((resumen2$`Cluster 1`),2)
resumen2$`Cluster 2`<- formattable::comma((resumen2$`Cluster 2`),2)
resumen2$`Cluster 3`<- formattable::comma((resumen2$`Cluster 3`),2)
resumen2$`Cluster 1`[1]<- formattable::comma((resumen2$`Cluster 1`[1]),0)
resumen2$`Cluster 2`[1]<- formattable::comma((resumen2$`Cluster 2`[1]),0)
resumen2$`Cluster 3`[1]<- formattable::comma((resumen2$`Cluster 3`[1]),0)
kableExtra::kable(resumen2,format = "markdown",caption = "Resumen de indicadores por cluster")
#xtable(resumen2, type="latex",auto = TRUE)
#agregamos a la base de datos original la denominación de cada cluster
datos<- cbind(datos,cluster=nomenclador)
clustersprov<-datos %>% select(Provincia,cluster)
datos %>% group_by(cluster) %>% summarise(habitantes=sum(`Habitantes (2010)`))
datos %>% group_by(cluster) %>% summarise(Provincia)
datos<- datos %>% mutate(Provincia=case_when(Provincia=="Tierra del Fuego, Antártida e Islas del Atlántico Sur (4)"~ "Tierra del Fuego, Antártida e Islas del Atlántico Sur",
TRUE~Provincia)) %>% arrange(Provincia)
fviz_cluster(km_clusters, data = datos4,
palette = c("RED", "BLUE","GREEN"),
ellipse.type = "euclid", # Concentration ellipse
star.plot = TRUE, # Add segments from centroids to items
repel = TRUE, # Avoid label overplotting (slow)
labelsize = 6, ) + theme_classic(base_family ="LM Roman 10" ) + labs(title="Plot de clusters resultantes de la macrolocalización") + theme(text=element_text(family = "LM Roman 10"), title = element_text(face = "bold"))
#ephtotal<- read_rds("ephtotal.Rds")
### provincia
provincia<- read.csv("provincias.csv", sep=",", header = T)
provincia<- provincia %>% arrange(PROVINCIA)
provincia1<- provincia %>% select(PROVINCIA,CH15_COD)
provincia2<- provincia %>% select(PROVINCIA,CH16_COD)
#
nombredato<- datos %>% select(Provincia)
nombredato
name_prov_para_datos<-bind_cols(nombredato, provincia) %>% select(-PROVINCIA)
datos<- left_join(datos,name_prov_para_datos)
#
cluster_nombres_eph<- datos %>% select(c("Provincia","cluster","CH15_COD","CH16_COD"))
cluster_nombres_eph<- cluster_nombres_eph %>% rename(provincia_origen=Provincia, cluster_origen=cluster)
cluster_nombres_eph_ch15<-cluster_nombres_eph %>% select(provincia_origen,CH15_COD, cluster_origen)
##############################################################################################
ephinmi<- ephtotal %>% filter(CH15==3)
ephinmi<- left_join(ephinmi, cluster_nombres_eph_ch15)
ephinmi %>% filter(!is.na(SECTOR_ACT)) %>% group_by(SECTOR_ACT) %>% summarise(porcentaje=formattable::percent (sum(PONDERA)/sum(ephinmi$PONDERA[!is.na(SECTOR_ACT)]))) %>% arrange(-porcentaje)
ephinmi %>% filter(!is.na(CALIFICACION)) %>% group_by(CALIFICACION) %>% summarise(porcentaje=formattable::percent (sum(PONDERA)/sum(ephinmi$PONDERA[!is.na(CALIFICACION)]))) %>% arrange(-porcentaje)
ephinmi<- ephinmi %>% filter(!is.na(provincia_origen))
prov_por_aglo<- read_csv("provincias_por_aglomerado.csv")
cluster_destino<- cluster_nombres_eph %>% select(provincia_origen,cluster_origen) %>% rename(provincia_destino=provincia_origen, cluster_destino=cluster_origen)
cluster_destino<- left_join(prov_por_aglo,cluster_destino)
ephinmi<- left_join(ephinmi,cluster_destino)
cuadro_2<-ephinmi %>% group_by("Cluster"=cluster_origen) %>% summarise("Porcentaje"=formattable::percent((sum(PONDERA)/sum(ephinmi$PONDERA))))
kableExtra::kable(cuadro_2,format = "markdown",caption = "Cluster de origen de los migrantes")
cuadro_3<-ephinmi %>% group_by("Cluster"=cluster_destino) %>% summarise("Porcentaje"=formattable::percent((sum(PONDERA)/sum(ephinmi$PONDERA))))
kableExtra::kable(cuadro_3,format = "markdown",caption = "Cluster de destino de los migrantes")
cuadro_4<- ephinmi %>% group_by("Provincia"=provincia_destino) %>% summarise("Inmigrantes"=sum(PONDERA))
cuadro_5<- ephinmi %>% group_by("Provincia"=provincia_origen) %>% summarise("Emigrantes"=sum(PONDERA))
cuadro_6<- full_join(cuadro_4,cuadro_5)
######
prov_aglo<- prov_por_aglo %>% rename(provincia=provincia_destino)
ephtotal<- left_join(ephtotal, prov_aglo)
prov_cluster<- clustersprov %>% mutate(Provincia=case_when(Provincia=="Tierra del Fuego, Antártida e Islas del Atlántico Sur (4)"~ "Tierra del Fuego, Antártida e Islas del Atlántico Sur",                              TRUE ~ Provincia))
#######
cuadro_7<- ephtotal %>% group_by("Provincia"=provincia) %>% summarise("Poblacion"=sum(PONDERA))
cuadro_8<- left_join(cuadro_6,cuadro_7)
cuadro_8<- left_join(cuadro_8,prov_cluster)
cuadro_8<- cuadro_8 %>% mutate(tasa_inmigracion=Inmigrantes/Poblacion, tasa_emigracion=Emigrantes/Poblacion, tasa_neta=tasa_inmigracion-tasa_emigracion)
cuadro_8$cluster<- factor(cuadro_8$cluster, levels = c("1","2","3"))
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.75))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.75)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "Tasa de inmigración y emigración por provincia", color="Cluster:")+ ggrepel::geom_text_repel(size=3,family = "LM Roman 10",show.legend = F)+theme(text=element_text(family = "LM Roman 10"),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"))
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.75))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.75)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "Tasa de inmigración y emigración por provincia", color="Cluster:")+ ggrepel::geom_text_repel(size=3,family = "LM Roman 10",show.legend = F)+theme(text=element_text(family = "LM Roman 10"),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"), legend.box.background = element_blank())
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.75))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.75)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "Tasa de inmigración y emigración por provincia", color="Cluster:")+ ggrepel::geom_text_repel(size=3,family = "LM Roman 10",show.legend = F)+theme(text=element_text(family = "LM Roman 10"),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"), legend.key = element_blank())
#Creación de regresores (feature engineerirng)
deflactor<- read_csv("deflactor.csv")
canastas<- read.csv("canasta.csv", sep=";", dec=".", header = TRUE)
ephtotal<- left_join(ephtotal, deflactor)
ephtotal<- ephtotal %>% mutate(HIJO=case_when(CH03==3~1,
TRUE ~ 0))
ephtotal<- ephtotal %>% group_by(ANO4, TRIMESTRE, CODUSU,NRO_HOGAR) %>% mutate(HIJO_HOGAR=sum(HIJO)) %>% ungroup()
ephtotal<- left_join(ephtotal,eph::adulto_equivalente)
ephtotal<- left_join(ephtotal,canastas)
ephtotal<- ephtotal %>% group_by(ANO4, TRIMESTRE, CODUSU,NRO_HOGAR) %>% mutate(EAF=sum(adequi)) %>% ungroup()
ephtotal<- ephtotal %>% mutate(CBAEQ=CBA*EAF,
CBTEQ=CBT*EAF)
ephtotal<- ephtotal %>% mutate(condicion=case_when(ITF<CBAEQ ~ "Indigente",
ITF>=CBAEQ & ITF<CBTEQ ~ "Pobre",
ITF>=CBTEQ ~ "No Pobre"))
ephtotal<- ephtotal %>% mutate(hombre=case_when(Sexo=="Hombres"~1,
Sexo=="Mujeres"~0),
edad=case_when(CH06=="-1" ~ as.integer(1),
TRUE ~ as.integer(CH06)),
edad2=(edad)^2,
ledad=log(edad),
medio=case_when(niveled=="Secundario\nCompleto"~ 1,
TRUE ~ 0),
alto=case_when(niveled=="Superior/Universitario\ncompleto"~ 1,
TRUE ~ 0),
IPCFR=IPCF/DEFLACTOR,
IPCFRL=log(IPCFR),
OCUPADO_BAJO=case_when(ESTADO==1 & CALIFICACION %in% c("No Calificados", "Operativos") ~ 1,
TRUE ~ 0),
OCUPADO_ALTO=case_when(ESTADO==1 & CALIFICACION %in% c("Profesionales","Técnicos") ~ 1,
TRUE ~ 0),
PROPIETARIO=case_when(II7==1 | II7==2 ~ 1,
TRUE ~ 0),
HIJO_DUMMY=case_when(HIJO_HOGAR==0 ~ 0,
TRUE ~ 1),
CASADO= case_when(CH07==1 | CH07==2 ~ 1 ,
TRUE ~ 0),
SOLTERO_C_HIJO=case_when(CASADO==0 & HIJO_DUMMY==1~1,
TRUE~0),
CASADO_S_HIJO=case_when(CASADO==1 & HIJO_DUMMY==0~ 1,
TRUE ~ 0),
CASADO_C_HIJO=case_when(CASADO==1 & HIJO_DUMMY==1~1,
TRUE~0),
POBRE=case_when(condicion %in% c("Pobre","Indigente")~1,
TRUE ~ 0),
SUBSIDIO=case_when(V5==1 ~ 1,
TRUE ~ 0)
)
cluster1_expulsion<- left_join(ephtotal,cluster_destino)
cluster1_expulsion<- left_join(cluster1_expulsion,cluster_nombres_eph_ch15)
cluster1_expulsion<- cluster1_expulsion %>%  filter(cluster_destino==1 | cluster_origen==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH03==1)
cluster1_expulsion<- cluster1_expulsion %>% filter(CH15%in% c(1,2,3))
cluster1_expulsion<- cluster1_expulsion %>% mutate(inmigrante=case_when(cluster_origen==1  &  CH15==3 &   cluster_destino!=1 ~1,
cluster_destino==1 & CH15 %in% c(1,2) ~0))
cluster1_expulsion<- cluster1_expulsion %>% filter(!is.na(inmigrante))
cluster_exp1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster1_expulsion,family = binomial(link="logit"))
cluster2_expulsion<- left_join(ephtotal,cluster_destino)
cluster2_expulsion<- left_join(cluster2_expulsion,cluster_nombres_eph_ch15)
cluster2_expulsion<- cluster2_expulsion %>%  filter(cluster_destino==2 | cluster_origen==2)
cluster2_expulsion<- cluster2_expulsion %>% filter(CH15%in% c(1,2,3))
cluster2_expulsion<- cluster2_expulsion %>% filter(CH03==1)
cluster2_expulsion<- cluster2_expulsion %>% mutate(inmigrante=case_when(cluster_origen==2  &  CH15==3 &   cluster_destino!=2~1,
cluster_destino==2 & CH15 %in% c(1,2) ~0))
cluster2_expulsion<- cluster2_expulsion %>% filter(!is.na(inmigrante))
cluster_exp2<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto, data= cluster2_expulsion,family = binomial(link = "logit"))
cluster3_expulsion<- left_join(ephtotal,cluster_destino)
cluster3_expulsion<- left_join(cluster3_expulsion,cluster_nombres_eph_ch15)
cluster3_expulsion<- cluster3_expulsion %>%  filter(cluster_destino==3 | cluster_origen==3)
cluster3_expulsion<- cluster3_expulsion %>% filter(CH15%in% c(1,2,3))
cluster3_expulsion<- cluster3_expulsion %>% filter(CH03==1)
cluster3_expulsion<- cluster3_expulsion %>% mutate(inmigrante=case_when(cluster_origen==3  &  CH15==3 &   cluster_destino!=3 ~1,
cluster_destino==3 & CH15 %in% c(1,2) ~0))
cluster3_expulsion<- cluster3_expulsion %>% filter(!is.na(inmigrante))
cluster_exp3<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto,data = cluster3_expulsion,family = binomial(link = "logit"))
install.packages("jtools")
summary(cluster_exp1,cluster_exp2, cluster_exp3)
summarise(cluster_exp1,cluster_exp2, cluster_exp3)
summary(cluster_exp1)
#Grafico de regresiones en stargazer
stargazer(cluster_exp1,cluster_exp2, cluster_exp3,font.size = "small")
cluster1_expulsion %>% group_by(CH06) %>% count()
cluster1_atraccion<- left_join(ephtotal,cluster_destino)
cluster1_atraccion<- left_join(cluster1_atraccion,cluster_nombres_eph_ch15)
cluster1_atraccion <- cluster1_atraccion %>% filter(CH15==3)
cluster1_atraccion<- cluster1_atraccion %>% mutate(inmigrante=case_when(cluster_destino==1 ~1,
(cluster_destino==2 | cluster_destino==3)~0))
cluster1_atraccion<- cluster1_atraccion %>% filter(!is.na(inmigrante))
cluster1_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster1_atraccion,family = binomial(link="logit"))
summary(cluster_atr1)
cluster2_atraccion<- left_join(ephtotal,cluster_destino)
cluster2_atraccion<- left_join(cluster2_atraccion,cluster_nombres_eph_ch15)
cluster2_atraccion <- cluster2_atraccion %>% filter(CH15==3)
cluster2_atraccion<- cluster2_atraccion %>% mutate(inmigrante=case_when(cluster_destino==2 ~1,
(cluster_destino==1 | cluster_destino==3)~0))
cluster2_atraccion<- cluster2_atraccion %>% filter(!is.na(inmigrante))
cluster2_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr2<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster2_atraccion,family = binomial(link="logit"))
summary(cluster_atr2)
cluster1_atraccion<- left_join(ephtotal,cluster_destino)
cluster1_atraccion<- left_join(cluster1_atraccion,cluster_nombres_eph_ch15)
cluster1_atraccion <- cluster1_atraccion %>% filter(CH15==3)
cluster1_atraccion<- cluster1_atraccion %>% mutate(inmigrante=case_when(cluster_destino==1 ~1,
(cluster_destino==2 | cluster_destino==3)~0))
cluster1_atraccion<- cluster1_atraccion %>% filter(!is.na(inmigrante))
cluster1_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr1<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster1_atraccion,family = binomial(link="logit"))
summary(cluster_atr1)
cluster2_atraccion<- left_join(ephtotal,cluster_destino)
cluster2_atraccion<- left_join(cluster2_atraccion,cluster_nombres_eph_ch15)
cluster2_atraccion <- cluster2_atraccion %>% filter(CH15==3)
cluster2_atraccion<- cluster2_atraccion %>% mutate(inmigrante=case_when(cluster_destino==2 ~1,
(cluster_destino==1 | cluster_destino==3)~0))
cluster2_atraccion<- cluster2_atraccion %>% filter(!is.na(inmigrante))
cluster2_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr2<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster2_atraccion,family = binomial(link="logit"))
summary(cluster_atr2)
cluster3_atraccion<- left_join(ephtotal,cluster_destino)
cluster3_atraccion<- left_join(cluster3_atraccion,cluster_nombres_eph_ch15)
cluster3_atraccion <- cluster3_atraccion %>% filter(CH15==3)
cluster3_atraccion<- cluster3_atraccion %>% mutate(inmigrante=case_when(cluster_destino==3 ~1,
(cluster_destino==1 | cluster_destino==2)~0))
cluster3_atraccion<- cluster3_atraccion %>% filter(!is.na(inmigrante))
cluster3_atraccion %>% group_by(inmigrante) %>% count()
cluster_atr3<- glm(inmigrante ~  hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto ,data = cluster3_atraccion,family = binomial(link="logit"))
summary(cluster_atr3)
stargazer(cluster_atr1,cluster_atr2, cluster_atr3,font.size = "small")
