#stargazer(sexo_edad,title = "Edad y género de los migrantes",summary = FALSE,label = "cuadro:edad_mig")
sexo_edad<- eph_carac %>% filter(CH06>=18) %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
sexo_edad$cluster_destino=paste0("Región ",sexo_edad$cluster_destino)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") +scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
#dev.off()
sexo_edad
sexo_edad<-sexo_edad %>% filter(!is.na(condicion_mig)) %>% group_by("Región"=cluster_destino,"Condición"=condicion_mig, "Género"=Sexo) %>% summarise("Mediana de Edad"=median(edad))
sexo_edad$Región<- str_replace(sexo_edad$Región,pattern = "textbf",replacement = "")
sexo_edad$Región<- str_replace_all(sexo_edad$Región,pattern = "[[:punct:]]",replacement = "")
#xtable(sexo_edad,caption = "Edad y género de los migrantes",label = "cuadro:edad_mig" ,align = c("c","c","c","c","c"))
#stargazer(sexo_edad,title = "Edad y género de los migrantes",summary = FALSE,label = "cuadro:edad_mig")
xtable(sexo_edad,caption = "Edad y género de los migrantes",label = "cuadro:edad_mig" ,align = c("c","c","c","c","c"))
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") +scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
eph_carac %>% group_by(migrante,cluster_destino) %>% count()
eph_carac %>% group_by(nativo,cluster_destino) %>% count()
sexo_edad<- eph_carac %>% filter(CH06>=18) %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
sexo_edad$cluster_destino=paste0("Región ",sexo_edad$cluster_destino)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") +scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
#dev.off()
sexo_edad
sexo_edad<-sexo_edad %>% filter(!is.na(condicion_mig)) %>% group_by("Región"=cluster_destino,"Condición"=condicion_mig, "Género"=Sexo) %>% summarise("Mediana de Edad"=median(edad))
sexo_edad$Región<- str_replace(sexo_edad$Región,pattern = "textbf",replacement = "")
sexo_edad$Región<- str_replace_all(sexo_edad$Región,pattern = "[[:punct:]]",replacement = "")
xtable(sexo_edad,caption = "Edad y género de los migrantes",label = "cuadro:edad_mig" ,align = c("c","c","c","c","c"))
#stargazer(sexo_edad,title = "Edad y género de los migrantes",summary = FALSE,label = "cuadro:edad_mig")
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") + xlim(c(16,110))+scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
sexo_edad<- eph_carac %>% filter(CH06>=18) %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
sexo_edad$cluster_destino=paste0("Región ",sexo_edad$cluster_destino)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") + xlim(c(16,110))+scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
#dev.off()
sexo_edad
sexo_edad<-sexo_edad %>% filter(!is.na(condicion_mig)) %>% group_by("Región"=cluster_destino,"Condición"=condicion_mig, "Género"=Sexo) %>% summarise("Mediana de Edad"=median(edad))
sexo_edad$Región<- str_replace(sexo_edad$Región,pattern = "textbf",replacement = "")
sexo_edad$Región<- str_replace_all(sexo_edad$Región,pattern = "[[:punct:]]",replacement = "")
xtable(sexo_edad,caption = "Edad y género de los migrantes",label = "cuadro:edad_mig" ,align = c("c","c","c","c","c"))
#stargazer(sexo_edad,title = "Edad y género de los migrantes",summary = FALSE,label = "cuadro:edad_mig")
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") + xlim(c(10,110))+scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
sexo_edad<- eph_carac %>% filter(CH06>=18) %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
sexo_edad$cluster_destino=paste0("Región ",sexo_edad$cluster_destino)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/edad_mig.tex",width = 6, height = 4,sanitize = TRUE)
sexo_edad %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping = aes(x=edad, group=condicion_mig, fill=condicion_mig)) + geom_density(alpha=0.5) + scale_fill_manual(values=color)+ xlab("Edad")+ ylab("Densidad")+ labs(fill="") + xlim(c(10,110))+scale_y_continuous(labels = scales::percent_format())+facet_grid(.~cluster_destino)+ theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank(), axis.line.x.bottom = element_line(color="BLACK"),axis.line.y.left = element_line(color="BLACK"))
#dev.off()
sexo_edad
sexo_edad<-sexo_edad %>% filter(!is.na(condicion_mig)) %>% group_by("Región"=cluster_destino,"Condición"=condicion_mig, "Género"=Sexo) %>% summarise("Mediana de Edad"=median(edad))
sexo_edad$Región<- str_replace(sexo_edad$Región,pattern = "textbf",replacement = "")
sexo_edad$Región<- str_replace_all(sexo_edad$Región,pattern = "[[:punct:]]",replacement = "")
xtable(sexo_edad,caption = "Edad y género de los migrantes",label = "cuadro:edad_mig" ,align = c("c","c","c","c","c"))
#stargazer(sexo_edad,title = "Edad y género de los migrantes",summary = FALSE,label = "cuadro:edad_mig")
pobreza<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
pre<-pobreza %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-pobreza %>% group_by(cluster_destino,  condicion_mig, POBRE) %>% summarise(Cantidad=sum(PONDERA))
pobreza<- left_join(post,pre)
pobreza$Porcentaje=formattable::percent((pobreza$Cantidad/pobreza$total),2)
pobreza$cluster_destino=paste0("Región ",pobreza$cluster_destino)
pobreza <- pobreza %>% mutate(POBRE=case_when(POBRE==1~ "Pobre",
POBRE==0~ "No pobre"))
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/pobre_mig.tex",width = 6, height = 4,sanitize = TRUE)
pobreza %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping=aes(x = condicion_mig, y =Porcentaje, fill=POBRE, label=Porcentaje)) + geom_col(position = position_fill(),width = 0.8) + facet_grid(cols = vars(cluster_destino)) + xlab("") + ylab("")+scale_y_continuous(labels = scales::percent_format())+ labs(fill="") + scale_fill_manual(values = color) + geom_text(position = position_fill(vjust = 0.4), size=3) + theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank())
#dev.off()
patrimonio<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
pre<-patrimonio %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-patrimonio %>% group_by(cluster_destino,  condicion_mig, PROPIETARIO) %>% summarise(Cantidad=sum(PONDERA))
patrimonio<- left_join(post,pre)
patrimonio$Porcentaje=formattable::percent((patrimonio$Cantidad/patrimonio$total),2)
patrimonio$cluster_destino=paste0("Región ",patrimonio$cluster_destino)
patrimonio <- patrimonio %>% mutate(PROPIETARIO=case_when(PROPIETARIO==1~ "Propietario",
PROPIETARIO==0~ "No propietario"))
patrimonio<- patrimonio %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymax=as.numeric(cumsum(Porcentaje)))
patrimonio<- patrimonio %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymin=c(0, head(ymax, n=-1)))
patrimonio<- patrimonio %>% group_by(cluster_destino, condicion_mig) %>% mutate(labelpos=(ymax+ymin)/2)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/vivienda_mig.tex",width = 6, height = 4,sanitize = TRUE)
patrimonio %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping=aes(ymax=ymax, ymin=ymin, xmax=4, xmin=0, fill=PROPIETARIO)) + scale_fill_manual(values = color)+
geom_rect() +
geom_text( x=2, aes(y=labelpos, label=Porcentaje), size=2.5)  +
coord_polar(theta="y") +
xlim(c(0, 4)) + facet_grid(cols = vars(condicion_mig),rows = vars(cluster_destino)) +
theme_void() +  labs(fill="") + theme( strip.background = element_blank(), panel.background = element_blank(), legend.position = "left")
#dev.off()
patrimonio<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
pre<-patrimonio %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-patrimonio %>% group_by(cluster_destino,  condicion_mig, PROPIETARIO) %>% summarise(Cantidad=sum(PONDERA))
patrimonio<- left_join(post,pre)
patrimonio$Porcentaje=formattable::percent((patrimonio$Cantidad/patrimonio$total),1)
patrimonio$cluster_destino=paste0("Región ",patrimonio$cluster_destino)
patrimonio <- patrimonio %>% mutate(PROPIETARIO=case_when(PROPIETARIO==1~ "Propietario",
PROPIETARIO==0~ "No propietario"))
patrimonio<- patrimonio %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymax=as.numeric(cumsum(Porcentaje)))
patrimonio<- patrimonio %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymin=c(0, head(ymax, n=-1)))
patrimonio<- patrimonio %>% group_by(cluster_destino, condicion_mig) %>% mutate(labelpos=(ymax+ymin)/2)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/vivienda_mig.tex",width = 6, height = 4,sanitize = TRUE)
patrimonio %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping=aes(ymax=ymax, ymin=ymin, xmax=4, xmin=0, fill=PROPIETARIO)) + scale_fill_manual(values = color)+
geom_rect() +
geom_text( x=2, aes(y=labelpos, label=Porcentaje), size=2.5)  +
coord_polar(theta="y") +
xlim(c(0, 4)) + facet_grid(cols = vars(condicion_mig),rows = vars(cluster_destino)) +
theme_void() +  labs(fill="") + theme( strip.background = element_blank(), panel.background = element_blank(), legend.position = "left")
#dev.off()
subsidios<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"))
pre<-subsidios %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-subsidios %>% group_by(cluster_destino,  condicion_mig, SUBSIDIO) %>% summarise(Cantidad=sum(PONDERA))
subsidios<- left_join(post,pre)
subsidios$Porcentaje=formattable::percent((subsidios$Cantidad/subsidios$total),2)
subsidios$cluster_destino=paste0("Región ",subsidios$cluster_destino)
subsidios <- subsidios %>% mutate(SUBSIDIO=case_when(SUBSIDIO==1~ "Recibe\nsubsidio",
SUBSIDIO==0~ "No recibe\nsubsidio"))
subsidios<- subsidios %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymax=as.numeric(cumsum(Porcentaje)))
subsidios<- subsidios %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymin=c(0, head(ymax, n=-1)))
subsidios<- subsidios %>% group_by(cluster_destino, condicion_mig) %>% mutate(labelpos=(ymax+ymin)/2)
#subsidios %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping=aes(ymax=ymax, ymin=ymin, xmax=4, xmin=0, fill=SUBSIDIO)) + scale_fill_manual(values = color)+
# geom_rect() +
#  geom_text( x=2, aes(y=labelpos, label=Porcentaje), size=2.5)  +
#  coord_polar(theta="y") +
#  xlim(c(0, 4)) + facet_grid(cols = vars(condicion_mig),rows = vars(cluster_destino)) +
#  theme_void() +  labs(fill="") + theme( strip.background = element_blank(), panel.background = element_blank(), legend.position = "left")
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/subsidio_mig.tex",width = 6, height = 4,sanitize = TRUE)
subsidios %>% filter(!is.na(condicion_mig)) %>% ggplot(mapping=aes(x = condicion_mig, y =Porcentaje, fill=SUBSIDIO, label=Porcentaje)) + geom_col(position = position_fill(),width = 0.8) + facet_grid(cols = vars(cluster_destino)) + xlab("") + ylab("")+scale_y_continuous(labels = scales::percent_format())+ labs(fill="") + scale_fill_manual(values = color) + geom_text(position = position_fill(vjust = 0.4), size=3) + theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank())
#dev.off()
ocupacion<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"),
pea=case_when(ESTADO %in% c(1,2) ~ 1,
ESTADO %in% c(3,4)~ 0))
pre<-ocupacion %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-ocupacion %>% group_by(cluster_destino,  condicion_mig, pea) %>% summarise(Cantidad=sum(PONDERA))
ocupacion<- left_join(post,pre)
ocupacion$Porcentaje=formattable::percent((ocupacion$Cantidad/ocupacion$total),2)
ocupacion <- ocupacion %>% mutate(SUBSIDIO=case_when(pea==1~ "Población Economicamente Activa",
pea==0~ "Población Economicamente Inactiva"))
ocupacion<- ocupacion %>% filter(!is.na(condicion_mig) & pea==1) %>% rename("Tasa de Actividad"=Porcentaje, "Región"=cluster_destino) %>% select(Región,condicion_mig,`Tasa de Actividad`)
ocupacion<- pivot_wider(ocupacion,names_from = condicion_mig, values_from = "Tasa de Actividad")
ocupacion
xtable(ocupacion,caption = "Tasa de actividad de nativos y migrantes",label = "cuadro:tasaactiv_mig" ,align = c("c","c","c","c"))
xtable(ocupacion,caption = "Tasa de actividad de nativos y migrantes",label = "cuadro:tasaactiv_mig" ,align = c("c","c","c","c"))
ocupacion<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"),
pea=case_when(ESTADO %in% c(1,2) ~ 1,
ESTADO %in% c(3,4)~ 0),
calif_ocup=case_when(OCUPADO_BAJO==1~ "Calificación baja",
OCUPADO_ALTO==1 ~ "Calificación alta"))
ocupacion<- ocupacion %>% filter(!is.na(calif_ocup))
pre<-ocupacion %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-ocupacion %>% group_by(cluster_destino,  condicion_mig, calif_ocup) %>% summarise(Cantidad=sum(PONDERA))
ocupacion<- left_join(post,pre)
ocupacion$Porcentaje=formattable::percent((ocupacion$Cantidad/ocupacion$total),2)
ocupacion$cluster_destino=paste0("Región ",ocupacion$cluster_destino)
ocupacion<- ocupacion %>% filter(!is.na(condicion_mig))
ocupacion<- ocupacion %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymax=as.numeric(cumsum(Porcentaje)))
ocupacion<- ocupacion %>% group_by(cluster_destino, condicion_mig) %>% mutate(ymin=c(0, head(ymax, n=-1)))
ocupacion<- ocupacion %>% group_by(cluster_destino, condicion_mig) %>% mutate(labelpos=(ymax+ymin)/2)
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/calif_mig.tex",width = 6, height = 4,sanitize = TRUE)
ocupacion  %>% ggplot(mapping=aes(ymax=ymax, ymin=ymin, xmax=4, xmin=0, fill=calif_ocup)) + scale_fill_manual(values = color)+
geom_rect() +
geom_text( x=2, aes(y=labelpos, label=Porcentaje), size=2.5)  +
coord_polar(theta="y") +
xlim(c(0, 4)) + facet_grid(rows = vars(condicion_mig),cols = vars(cluster_destino)) +
theme_void() +  labs(fill="") + theme( strip.background = element_blank(), panel.background = element_blank(), legend.position = "bottom")
#dev.off()
org_fam<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"),
pea=case_when(ESTADO %in% c(1,2) ~ 1,
ESTADO %in% c(3,4)~ 0),
estado_civil=case_when(SOLTERO_C_HIJO==1~ "Soltero/a con hijo/a",
CASADO_C_HIJO==1 ~ "Casado/a con hijo/a",
CASADO_S_HIJO==1 ~ "Casado/a sin hijo/a",
CASADO==0 & HIJO_DUMMY==0 ~ "Soltero/a sin hijo/a"))
org_fam<- org_fam %>% filter(!is.na(estado_civil) & CH06>=18)
pre<-org_fam %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-org_fam %>% group_by(cluster_destino,  condicion_mig, estado_civil) %>% summarise(Cantidad=sum(PONDERA))
org_fam<- left_join(post,pre)
org_fam$Porcentaje=formattable::percent((org_fam$Cantidad/org_fam$total),2)
org_fam$cluster_destino=paste0("Región ",org_fam$cluster_destino)
org_fam<- org_fam %>% filter(!is.na(condicion_mig))
org_fam
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/estadociv_mig.tex",width = 6, height = 4,sanitize = TRUE)
org_fam  %>%   ggplot(mapping=aes(x = condicion_mig, y =Porcentaje, fill=estado_civil, label=Porcentaje)) + geom_col(position = position_fill(),width = 0.8) + facet_grid(cols = vars(cluster_destino)) + xlab("") + ylab("")+scale_y_continuous(labels = scales::percent_format())+ labs(fill="") + scale_fill_manual(values = color) + geom_text(position = position_fill(vjust = 0.4), size=3) + theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank())
#dev.off()
niveled<- eph_carac %>% mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"),
pea=case_when(ESTADO %in% c(1,2) ~ 1,
ESTADO %in% c(3,4)~ 0),
niveled=case_when(niveled %in% c("Sin\ninstrucción","Primario\nCompleto") ~ "Nivel educativo\nBajo",
niveled=="Secundario\nCompleto" ~ "Nivel educativo\nmedio",
niveled== "Superior/Universitario\ncompleto" ~ "Nivel educativo\nelevado"))
niveled$niveled<- factor(niveled$niveled, levels=c("Nivel educativo\nelevado","Nivel educativo\nmedio","Nivel educativo\nBajo"))
niveled<- niveled %>% filter(!is.na(niveled) & CH06>=18)
pre<-niveled %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-niveled %>% group_by(cluster_destino,  condicion_mig, niveled) %>% summarise(Cantidad=sum(PONDERA))
niveled<- left_join(post,pre)
niveled$Porcentaje=formattable::percent((niveled$Cantidad/niveled$total),2)
niveled$cluster_destino=paste0("Región ",niveled$cluster_destino)
niveled<- niveled %>% filter(!is.na(condicion_mig))
niveled
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/niveled_mig.tex",width = 6, height = 4,sanitize = TRUE)
niveled  %>%   ggplot(mapping=aes(x = condicion_mig, y =Porcentaje, fill=niveled, label=Porcentaje)) + geom_col(position = position_fill(),width = 0.8) + facet_grid(cols = vars(cluster_destino)) + xlab("") + ylab("")+scale_y_continuous(labels = scales::percent_format())+ labs(fill="") + scale_fill_manual(values = color) + geom_text(position = position_fill(vjust = 0.4), size=3) + theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank())
#dev.off()
niveled<- eph_carac %>% filter(CH06>=25) %>%  mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"),
pea=case_when(ESTADO %in% c(1,2) ~ 1,
ESTADO %in% c(3,4)~ 0),
niveled=case_when(niveled %in% c("Sin\ninstrucción","Primario\nCompleto") ~ "Nivel educativo\nBajo",
niveled=="Secundario\nCompleto" ~ "Nivel educativo\nmedio",
niveled== "Superior/Universitario\ncompleto" ~ "Nivel educativo\nelevado"))
niveled$niveled<- factor(niveled$niveled, levels=c("Nivel educativo\nelevado","Nivel educativo\nmedio","Nivel educativo\nBajo"))
niveled<- niveled %>% filter(!is.na(niveled) & CH06>=18)
pre<-niveled %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-niveled %>% group_by(cluster_destino,  condicion_mig, niveled) %>% summarise(Cantidad=sum(PONDERA))
niveled<- left_join(post,pre)
niveled$Porcentaje=formattable::percent((niveled$Cantidad/niveled$total),2)
niveled$cluster_destino=paste0("Región ",niveled$cluster_destino)
niveled<- niveled %>% filter(!is.na(condicion_mig))
niveled
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/niveled_mig.tex",width = 6, height = 4,sanitize = TRUE)
niveled  %>%   ggplot(mapping=aes(x = condicion_mig, y =Porcentaje, fill=niveled, label=Porcentaje)) + geom_col(position = position_fill(),width = 0.8) + facet_grid(cols = vars(cluster_destino)) + xlab("") + ylab("")+scale_y_continuous(labels = scales::percent_format())+ labs(fill="") + scale_fill_manual(values = color) + geom_text(position = position_fill(vjust = 0.4), size=3) + theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank())
#dev.off()
niveled<- eph_carac  %>%  mutate(condicion_mig=case_when(migrante==1 ~ "Migrantes",
nativo==1 ~ "Nativos"),
pea=case_when(ESTADO %in% c(1,2) ~ 1,
ESTADO %in% c(3,4)~ 0),
niveled=case_when(niveled %in% c("Sin\ninstrucción","Primario\nCompleto") ~ "Nivel educativo\nBajo",
niveled=="Secundario\nCompleto" ~ "Nivel educativo\nmedio",
niveled== "Superior/Universitario\ncompleto" ~ "Nivel educativo\nelevado"))
niveled$niveled<- factor(niveled$niveled, levels=c("Nivel educativo\nelevado","Nivel educativo\nmedio","Nivel educativo\nBajo"))
niveled<- niveled %>% filter(!is.na(niveled) & CH06>=26)
pre<-niveled %>% group_by(cluster_destino,  condicion_mig) %>% summarise(total=sum(PONDERA))
post<-niveled %>% group_by(cluster_destino,  condicion_mig, niveled) %>% summarise(Cantidad=sum(PONDERA))
niveled<- left_join(post,pre)
niveled$Porcentaje=formattable::percent((niveled$Cantidad/niveled$total),2)
niveled$cluster_destino=paste0("Región ",niveled$cluster_destino)
niveled<- niveled %>% filter(!is.na(condicion_mig))
niveled
#tikz("/home/alejandrochain/Documentos/GitHub/investigacion2021/latex/graficos/niveled_mig.tex",width = 6, height = 4,sanitize = TRUE)
niveled  %>%   ggplot(mapping=aes(x = condicion_mig, y =Porcentaje, fill=niveled, label=Porcentaje)) + geom_col(position = position_fill(),width = 0.8) + facet_grid(cols = vars(cluster_destino)) + xlab("") + ylab("")+scale_y_continuous(labels = scales::percent_format())+ labs(fill="") + scale_fill_manual(values = color) + geom_text(position = position_fill(vjust = 0.4), size=3) + theme(axis.text = element_text(color = "BLACK"), strip.background = element_blank(), panel.background = element_blank())
#dev.off()
View(cluster_destino)
#tomamos la base completa y definimos el cluster de destino para los migrantes
cluster_multinom<- left_join(ephtotal,cluster_destino)
#hacemos lo mismo con el cluster de origen de los migrantes
cluster_multinom<- left_join(cluster_multinom,cluster_nombres_eph_ch16)
cluster_multinom<- cluster_multinom %>% filter(CH03==1)
cluster_multinom<- cluster_multinom %>% filter(CH16%in% c(1,2,3))
# definimos la variable inmigrante que serà igual a 0 para los que son nativos de la provincia en la que habitan
# igual a 1 si la region a la que migraron es la 1
#igual a 2 si la region a la que migraron es la 2
#igual a 3 si la region a la que migraron es la 3
cluster_multinom<- cluster_multinom %>% mutate(inmigrante=case_when(#cluster_origen==3  &  CH15==3 &   cluster_destino==3 ~ 3,
cluster_destino==3 & CH15 %in% c(1,2) & CH16 %in% c(1,2) ~0,
cluster_origen==3  &  CH16==3 &   cluster_destino==2 ~2,
cluster_origen==3  &  CH16==3 &   cluster_destino==1 ~1,
#cluster_origen==2  &  CH15==3 &   cluster_destino==2 ~ 2,
cluster_destino==2 & CH15 %in% c(1,2) & CH16 %in% c(1,2) ~0,
cluster_origen==2  &  CH16==3 &   cluster_destino==3 ~3,
cluster_origen==2  &  CH16==3 &   cluster_destino==1 ~1,
#cluster_origen==1  &  CH15==3 &   cluster_destino==1 ~ 1,
cluster_destino==1 & CH15 %in% c(1,2) & CH16 %in% c(1,2) ~0,
cluster_origen==1  &  CH16==3 &   cluster_destino==3 ~3,
cluster_origen==1  &  CH16==3 &   cluster_destino==2 ~2))
#filtramos la base para solo tener en cuenta nativos y migrantes de regiones distintas de las que tienen de origen
cluster_multinom<- cluster_multinom %>% filter(!is.na(inmigrante))
table(cluster_multinom$inmigrante)
cluster_multinom<- left_join(ephtotal,cluster_destino)
#hacemos lo mismo con el cluster de origen de los migrantes
cluster_multinom<- left_join(cluster_multinom,cluster_nombres_eph_ch16)
cluster_multinom<- cluster_multinom %>% filter(CH03==1)
cluster_multinom<- cluster_multinom %>% filter(CH16%in% c(1,2,3))
# definimos la variable inmigrante que serà igual a 0 para los que son nativos de la provincia en la que habitan
# igual a 1 si la region a la que migraron es la 1
#igual a 2 si la region a la que migraron es la 2
#igual a 3 si la region a la que migraron es la 3
cluster_multinom<- cluster_multinom %>% mutate(inmigrante=case_when(cluster_origen==3  &  CH16==3 &   cluster_destino==3 ~ 3,
cluster_destino==3 & CH15 %in% c(1,2) & CH16 %in% c(1,2) ~0,
cluster_origen==3  &  CH16==3 &   cluster_destino==2 ~2,
cluster_origen==3  &  CH16==3 &   cluster_destino==1 ~1,
cluster_origen==2  &  CH16==3 &   cluster_destino==2 ~ 2,
cluster_destino==2 & CH15 %in% c(1,2) & CH16 %in% c(1,2) ~0,
cluster_origen==2  &  CH16==3 &   cluster_destino==3 ~3,
cluster_origen==2  &  CH16==3 &   cluster_destino==1 ~1,
cluster_origen==1  &  CH16==3 &   cluster_destino==1 ~ 1,
cluster_destino==1 & CH15 %in% c(1,2) & CH16 %in% c(1,2) ~0,
cluster_origen==1  &  CH16==3 &   cluster_destino==3 ~3,
cluster_origen==1  &  CH16==3 &   cluster_destino==2 ~2))
#filtramos la base para solo tener en cuenta nativos y migrantes de regiones distintas de las que tienen de origen
cluster_multinom<- cluster_multinom %>% filter(!is.na(inmigrante))
table(cluster_multinom$inmigrante)
# definimos que el grupo base es el de los nativos
cluster_multinom$inmigrante<- as.factor(cluster_multinom$inmigrante)
cluster_multinom$inmigrante<- relevel(cluster_multinom$inmigrante, ref = "0")
# estimamos el modelo con los regresores determinados
cluster_multinom_model<-multinom(inmigrante~ hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto, data=cluster_multinom)
stargazer(cluster_multinom_model,type = 'text' )
#tomamos la base completa y definimos el cluster de destino para los migrantes
data_migracion<- left_join(ephtotal,cluster_destino)
#hacemos lo mismo con el cluster de origen de los migrantes
data_migracion<- left_join(data_migracion,cluster_nombres_eph_ch16)
data_migracion<- data_migracion %>% filter(CH03==1)
data_migracion<- data_migracion %>% filter(CH16 %in% c(1,2,3))
data_migracion<- data_migracion %>% mutate(migrante=case_when(CH16==3 ~ 1,
TRUE ~ 0),
nativo=case_when(CH16 %in% c(1,2) & CH15 %in% c(1,2) ~ 1,
TRUE ~ 0))
data_migracion<- data_migracion %>% mutate(inmigrante=case_when(migrante==1 ~ 1,
nativo==1 ~ 0))
data_migracion<- data_migracion %>% filter(!is.na(inmigrante))
table(data_migracion$inmigrante)
probit_migracion<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto, data=data_migracion,family = 'binomial')
summary(probit_migracion)
data_migracion %>% group_by(provincia_destino) %>% unique(cluster_destino)
data_migracion %>% group_by(provincia_destino) %>% summarise(cluster_destino)
data_migracion %>% group_by(provincia_destino) %>% distinct(cluster_destino)
#tomamos la base completa y definimos el cluster de destino para los migrantes
data_migracion<- left_join(ephtotal,cluster_destino)
#hacemos lo mismo con el cluster de origen de los migrantes
data_migracion<- left_join(data_migracion,cluster_nombres_eph_ch16)
data_migracion<- data_migracion %>% filter(CH03==1)
data_migracion<- data_migracion %>% filter(CH16 %in% c(1,2,3))
data_migracion<- data_migracion %>% mutate(migrante=case_when(CH16==3 ~ 1,
TRUE ~ 0),
nativo=case_when(CH16 %in% c(1,2) & CH15 %in% c(1,2) ~ 1,
TRUE ~ 0))
data_migracion<- data_migracion %>% mutate(inmigrante=case_when(migrante==1 ~ 1,
nativo==1 ~ 0),
SUR=case_when(cluster_destino==1,
TRUE ~ 0),
NORTE=case_when(cluster_destino==2,
TRUE ~ 0),
CENTRO=case_when(cluster_destino==3,
TRUE ~ 0))
#tomamos la base completa y definimos el cluster de destino para los migrantes
data_migracion<- left_join(ephtotal,cluster_destino)
#hacemos lo mismo con el cluster de origen de los migrantes
data_migracion<- left_join(data_migracion,cluster_nombres_eph_ch16)
data_migracion<- data_migracion %>% filter(CH03==1)
data_migracion<- data_migracion %>% filter(CH16 %in% c(1,2,3))
data_migracion<- data_migracion %>% mutate(migrante=case_when(CH16==3 ~ 1,
TRUE ~ 0),
nativo=case_when(CH16 %in% c(1,2) & CH15 %in% c(1,2) ~ 1,
TRUE ~ 0))
data_migracion<- data_migracion %>% mutate(inmigrante=case_when(migrante==1 ~ 1,
nativo==1 ~ 0),
SUR=case_when(cluster_destino==1~ 1,
TRUE ~ 0),
NORTE=case_when(cluster_destino==2 ~ 1,
TRUE ~ 0),
CENTRO=case_when(cluster_destino==3~ 1,
TRUE ~ 0))
data_migracion<- data_migracion %>% filter(!is.na(inmigrante))
probit_migracion<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto + SUR + NORTE + CENTRO, data=data_migracion,family = 'binomial')
summary(probit_migracion)
probit_migracion<- glm(inmigrante ~ hombre + POBRE + SUBSIDIO + OCUPADO_BAJO+OCUPADO_ALTO +  SOLTERO_C_HIJO+CASADO_S_HIJO + CASADO_C_HIJO+ PROPIETARIO+  + edad + edad2  + medio + alto + SUR  + CENTRO, data=data_migracion,family = 'binomial')
summary(probit_migracion)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=(function(x) exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=percent_format(function(x) exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(function(x) exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent(x = function(x) exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent(function(x) exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(function(x) exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent(x=(function(x) exp(x)))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent(x=exp(tasa_inmigracion))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent(exp(tasa_inmigracion))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(exp(tasa_inmigracion))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=function(x) exp(x)) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=function(x) formattable::percent(exp(x))) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_emigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=function(x) formattable::percent(exp(x))) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scale::percent_format()) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format()) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin = 0.4) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),end = 0.8) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_inmigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),end = 0.9) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=log(tasa_emigracion)),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),end = 0.9) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_emigracion
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),end = 0.9) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),end = 0.9) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_emigracion
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_emigracion
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = 0.8) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de inmigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de emigración:") + theme(text=element_text(), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
mapa_emigracion
provincia<- provincia %>% arrange(PROVINCIA)
provincia1<- provincia %>% select(PROVINCIA,CH15_COD)
provincia2<- provincia %>% select(PROVINCIA,CH16_COD)
#
nombredato<- macroloc %>% select(Provincia)
nombredato
name_prov_para_datos<-bind_cols(nombredato, provincia) %>% select(-PROVINCIA)
macroloc<- left_join(macroloc,name_prov_para_datos)
#
cluster_nombres_eph<- macroloc %>% select(c("Provincia","cluster","CH15_COD","CH16_COD"))
cluster_nombres_eph<- cluster_nombres_eph %>% rename(provincia_origen=Provincia, cluster_origen=cluster)
cluster_nombres_eph_ch16<-cluster_nombres_eph %>% select(provincia_origen,CH16_COD, cluster_origen)
##############################################################################################
ephinmi<- ephtotal %>% filter(CH16==3)
ephinmi<- left_join(ephinmi, cluster_nombres_eph_ch16)
ephinmi<- ephinmi %>% filter(!is.na(provincia_origen))
temp<- tempfile()
download.file("https://github.com/alechain/investigacion2021/raw/main/macrolocalizacion/provincias_por_aglomerado.csv", temp)
prov_por_aglo<- read_csv(temp)
unlink(temp)
cluster_destino<- cluster_nombres_eph %>% select(provincia_origen,cluster_origen) %>% rename(provincia_destino=provincia_origen, cluster_destino=cluster_origen)
cluster_destino<- left_join(prov_por_aglo,cluster_destino)
ephinmi<- left_join(ephinmi,cluster_destino)
cuadro_4<- ephinmi %>% group_by("Provincia"=provincia_destino) %>% summarise("Inmigrantes"=sum(PONDERA))
cuadro_5<- ephinmi %>% group_by("Provincia"=provincia_origen) %>% summarise("Emigrantes"=sum(PONDERA))
cuadro_6<- full_join(cuadro_4,cuadro_5)
######
prov_aglo<- prov_por_aglo %>% rename(provincia=provincia_destino)
ephtotal<- left_join(ephtotal, prov_aglo)
prov_cluster<- clustersprov %>% mutate(Provincia=case_when(Provincia=="Tierra del Fuego, Antártida e Islas del Atlántico Sur (4)"~ "Tierra del Fuego, Antártida e Islas del Atlántico Sur",                              TRUE ~ Provincia))
#######
cuadro_7<- ephtotal %>% group_by("Provincia"=provincia) %>% summarise("Poblacion"=sum(PONDERA))
cuadro_8<- left_join(cuadro_6,cuadro_7)
cuadro_8<- left_join(cuadro_8,prov_cluster)
cuadro_8<- cuadro_8 %>% mutate(tasa_inmigracion=Inmigrantes/Poblacion, tasa_emigracion=Emigrantes/Poblacion, tasa_neta=tasa_inmigracion-tasa_emigracion)
cuadro_8$cluster<- factor(cuadro_8$cluster, levels = c("1","2","3"))
### Mapa de migraciony emigracion por provincia
temp<- tempfile()
download.file("https://github.com/alechain/investigacion2021/raw/main/macrolocalizacion/mapa/gadm36_ARG_shp.zip", temp)
g<-unzip(temp,files = c("gadm36_ARG_1.shp","gadm36_ARG_1.cpg","gadm36_ARG_1.dbf","gadm36_ARG_1.prj","gadm36_ARG_1.shx"))
datos_mapa_prov<- st_read(g[1])
datos_mapa_prov<- datos_mapa_prov %>% rename(Provincia=NAME_1)
datos_mapa_prov<- datos_mapa_prov %>% mutate(Provincia=case_when(Provincia=="Ciudad de Buenos Aires"  ~ "Ciudad Autónoma de Buenos Aires",
Provincia=="Tierra del Fuego"  ~"Tierra del Fuego, Antártida e Islas del Atlántico Sur",
TRUE~Provincia))
cuadro_9<- cuadro_8 %>% mutate(tasa_inmigracion=formattable::percent(tasa_inmigracion),tasa_emigracion=formattable::percent(tasa_emigracion))
cuadro_9<- cuadro_9 %>% mutate(cluster=case_when(cluster==1 ~ "Sur",
cluster==2 ~ "Norte",
cluster==3 ~ "Centro"))
cuadro_9$cluster<- factor(x = cuadro_9$cluster,levels = c("Norte","Centro","Sur"))
reg_tradi<- macroloc %>% select(Provincia,NOA,NEA,`NUEVO CUYO`,`CENTRO Y GBA`,PATAGONIA)
reg_tradi<- reg_tradi %>% mutate(region=case_when(NOA==1~ "NOA",
NEA==1~ "NEA",
`NUEVO CUYO`==1 ~ "Nuevo Cuyo",
`CENTRO Y GBA`==1 ~ "Centro y GBA",
PATAGONIA==1~ "Patagonia"))
reg_tradi<- reg_tradi %>% select(Provincia,region)
datos_mapa_reg_geo<- inner_join(datos_mapa_prov,reg_tradi)
datos_mapa_prov<- inner_join(datos_mapa_prov, cuadro_9)
#extrafont::font_import(paths = "/home/alejandrochain/Documentos/GitHub/investigacion2021/macrolocalizacion/fuentes")
#extrafont::loadfonts(device = "pdf",quiet = T)
#pdf(file = "/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/mapa_regiones.pdf", width = 8,height = 4)
mapa_cluster<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=cluster),color="BLACK", size=0.2 ) + labs(fill="Región:") + scale_fill_manual(values=color)+ theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_tradi<- ggplot(data =datos_mapa_reg_geo) + geom_sf(aes(fill=region), color='BLACK', size=0.2)+ labs(fill="Región:") + scale_fill_manual(values=color[c(1:4,8:9)]) + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapas_reg<- ggpubr::ggarrange(mapa_cluster,mapa_tradi)
mapas_reg
#dev.off()
cuadro_2<-ephinmi %>% group_by("Región"=cluster_origen) %>% summarise("Porcentaje"=formattable::percent((sum(PONDERA)/sum(ephinmi$PONDERA))))
kableExtra::kable(cuadro_2,format = "html",caption = "Regiones de origen de los migrantes")
cuadro_3<-ephinmi %>% group_by("Región"=cluster_destino) %>% summarise("Porcentaje"=formattable::percent((sum(PONDERA)/sum(ephinmi$PONDERA))))
kableExtra::kable(cuadro_3,format = "html",caption = "Regiones de destino de los migrantes")
tikz(file="/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/tasas_emig_inmig_prov.tex",sanitize = TRUE, width = 6,height = 4)
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.08))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.08)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "", color="Región:")+ ggrepel::geom_text_repel(size=3,show.legend = F)+theme(text=element_text(),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"), legend.key = element_blank(),legend.position = 'bottom')
dev.off()
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.08))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.08)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "", color="Región:")+ ggrepel::geom_text_repel(size=2,show.legend = F)+theme(text=element_text(),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"), legend.key = element_blank(),legend.position = 'bottom')
tikz(file="/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/tasas_emig_inmig_prov.tex",sanitize = TRUE, width = 6,height = 4)
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.08))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.08)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "", color="Región:")+ ggrepel::geom_text_repel(size=2,show.legend = F)+theme(text=element_text(),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"), legend.key = element_blank(),legend.position = 'bottom')
dev.off()
tikz(file="/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/tasas_emig_inmig_prov.tex",sanitize = TRUE, width = 6,height = 4)
cuadro_8 %>% ggplot(mapping=aes(x=tasa_inmigracion,y = tasa_emigracion, label=Provincia, color=cluster)) + geom_point(show.legend = T) + geom_abline(intercept=-0,slope = 1)+ scale_color_manual(values = color)+ scale_y_continuous(labels = scales::percent_format(),limits = c(0,0.08))+scale_x_continuous(labels = scales::percent_format(),limits = c(0,0.08)) + xlab("Tasa de inmigración") + ylab("Tasa de emigración")+ labs(title = "", color="Región:")+ ggrepel::geom_text_repel(size=1.5,show.legend = F)+theme(text=element_text(),axis.line = element_line(color="BLACK") ,axis.text = element_text(size=7, color = "BLACK") , panel.background = element_blank(),  axis.title = element_text(size=7), title = element_text(face = "bold"), legend.key = element_blank(),legend.position = 'bottom')
dev.off()
pdf(file = "/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/emig_inmig_por_prov.pdf", width = 8,height = 4)
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
dev.off()
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de inmigración:") + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de emigración:") + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
#pdf(file = "/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/emig_inmig_por_prov.pdf", width = 8,height = 4)
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
pdf(file = "/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/emig_inmig_por_prov.pdf", width = 8,height = 4)
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
dev.off()
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de\ninmigración:") + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de\nemigración:") + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
pdf(file = "/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/emig_inmig_por_prov.pdf", width = 8,height = 4)
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
dev.off()
mapa_inmigracion<-ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_inmigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de\ninmigración:") + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
mapa_emigracion<- ggplot(data = datos_mapa_prov) + geom_sf(aes(fill=tasa_emigracion),color="BLACK", size=0.2 ) + viridis::scale_fill_viridis(label=scales::percent_format(),begin=0.1,alpha = .9) + labs(fill="Tasa de\nemigración:") + theme(text=element_text(family="LM Roman 10"), panel.background = element_blank() , axis.text = element_blank(), axis.ticks = element_blank())
pdf(file = "/home/alejandrochain/Documentos/GitHub/investigacion2021/latex_regiones_class/graficos/emig_inmig_por_prov.pdf", width = 6,height = 3)
gridExtra::grid.arrange(mapa_emigracion,mapa_inmigracion, ncol=2)
dev.off()
View(datos_mapa_prov)
View(cuadro_9)
