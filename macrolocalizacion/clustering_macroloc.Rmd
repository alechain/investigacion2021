---
title: "Macrolocalizacion de regiones con K-means"
output:
  html_document:
    df_print: paged
---
```{r}
setwd("/home/alejandrochain/Documentos/GitHub/investigacion2021/macrolocalizacion")
library(readr)
library(tidyverse)
library(factoextra)
library(cluster)
library(fpc)


```

## Carga de datos
Para comenzar, cargamos los datos de las variables sociales y economicas que definen a las distintas provincias de la Argentina.
```{r}
datos<- read_csv("macroloc_para_r.csv",col_names = T, row.names(1))
datos3<- datos %>% select(-Provincia)
row.names(datos3)<- datos$Provincia
datos4<- datos3
#datos<- datos %>% mutate(`Densidad poblacional: Hab/km² (2010)`=log(`Densidad poblacional: Hab/km² (2010)`))
```

##Normalización de la base de datos
Ahora normalizamos la base de datos para lograr coherencia en la aplicación de K-means, debido a quen trabajamos con distintas escalas de datos.
```{r}
datos3<-datos3 %>% select(-c(`Densidad poblacional: Hab/km² (2010)`))
datos_norm<- scale(datos3)
```
## Número de clusters óptimo
Verificamos el numero de clusters optimos a través de el Within sum of square
```{r}
factoextra::fviz_nbclust(datos_norm,kmeans, method="wss")

```

Obtenemos que el numero óptimo de clusters se encuentra en torno al **número 2**.

## Cómputo de las K-means 
Setearemos una semilla para el cálculo de los centroides iniciales del algoritmo de K-means y procederemos a realizar el cálculo de los clusters a través de 25 iteraciones, eligiendo la que de menor numero de WSS.
```{r}
set.seed(1118)
km_clusters<- kmeans(datos_norm,centers = 2,iter.max = 1000)
nomenclador<- km_clusters$cluster
```
Podemos ver la media de los parámetros para cada uno de los clusters
```{r}
aggregate(datos3,by = list(cluster=km_clusters$cluster),FUN = median)
```
agregamos a la base de datos original la denominación de cada cluster
```{r}
datos<- cbind(datos,cluster=nomenclador)
clustersprov<-datos %>% select(Provincia,cluster)
datos %>% group_by(cluster) %>% summarise(habitantes=sum(`Habitantes (2010)`))
datos %>% group_by(cluster) %>% summarise(Provincia)
```
```{r}
fviz_cluster(km_clusters, data = datos4,
palette = c("#2E9FDF", "#00AFBB", "#E7B800", "#FC4E07"),
ellipse.type = "euclid", # Concentration ellipse
star.plot = TRUE, # Add segments from centroids to items
repel = TRUE, # Avoid label overplotting (slow)
ggtheme = theme_minimal()
)
```

```{r}
fviz_nbclust(datos_norm,pam,method="silhouette")

```
```{r}
pam_cluster<- pam(datos_norm,2)

datospam<- bind_cols(datos,clusters_pam=pam_cluster$clustering)
datospam %>% group_by(clusters_pam) %>% summarise(Provincia)
```

